{"version":3,"file":"utils.js","sourceRoot":"","sources":["../src/utils.ts"],"names":[],"mappings":";;;AAAA,+BAA+B;AAG/B,SAAgB,gBAAgB,CAAC,KAAc;IAC7C,OAAO,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;AAClD,CAAC;AAFD,4CAEC;AAED,SAAS,oBAAoB,CAAC,IAAU,EAAE,SAAiB,EAAE,SAAkB;IAC7E,OAAO,IAAI,CAAC,SAAS,KAAK,SAAS,IAAI,CAAC,IAAI,CAAC,YAAY,KAAK,SAAS,IAAI,SAAS,IAAI,IAAI,CAAC,CAAC;AAChG,CAAC;AAED,SAAS,oBAAoB,CAAC,IAAU,EAAE,SAAiB,EAAE,SAAkB,EAAE,IAAc;IAC7F,OAAO,CACL,IAAI,CAAC,SAAS,KAAK,SAAS;QAC5B,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,IAAI,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,YAAY,MAAK,SAAS,CAAC,IAAI,SAAS,IAAI,IAAI,CAAC,CAChF,CAAC;AACJ,CAAC;AAED,SAAgB,QAAQ,CAAC,OAAgB,EAAE,SAAiB,EAAE,SAAkB;IAC9E,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAClD,MAAM,IAAI,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QAEnC,IACE,oBAAoB,CAAC,IAAI,EAAE,SAAS,EAAE,SAAS,CAAC;YAChD,oBAAoB,CAAC,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,OAAO,CAAC,EACzD;YACA,OAAO,IAAI,CAAC;SACb;KACF;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAZD,4BAYC;AAED,SAAgB,YAAY,CAAC,IAAqB,EAAE,SAAiB,EAAE,SAAkB;;IACvF,MAAM,OAAO,GAAG,MAAC,IAAiB,CAAC,eAAe,mCAAI,IAAI,CAAC;IAC3D,MAAM,GAAG,GAAc,EAAE,CAAC;IAC1B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAClD,MAAM,KAAK,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACpC,IACE,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC;YACtB,KAAK,CAAC,SAAS,KAAK,SAAS;YAC7B,CAAC,KAAK,CAAC,YAAY,KAAK,SAAS,IAAI,SAAS,IAAI,IAAI,CAAC,EACvD;YACA,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACjB;KACF;IACD,OAAO,GAAG,CAAC;AACb,CAAC;AAdD,oCAcC;AAED,kBAAkB;AAClB,SAAgB,UAAU,CAAC,IAAqB,EAAE,SAAiB,EAAE,SAAkB;IACrF,OAAO,YAAY,CAAC,IAAI,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC;AAClD,CAAC;AAFD,gCAEC;AAED,MAAM,gCAAgC,GAAG;IACvC,GAAG,EAAE,OAAO;IACZ,GAAG,EAAE,MAAM;IACX,GAAG,EAAE,QAAQ;IACb,IAAI,EAAE,OAAO;IACb,IAAI,EAAE,OAAO;IACb,IAAI,EAAE,OAAO;CACd,CAAC;AAEF,MAAM,2BAA2B,GAAG;IAClC,GAAG,EAAE,OAAO;IACZ,GAAG,EAAE,MAAM;IACX,GAAG,EAAE,MAAM;IACX,IAAI,EAAE,OAAO;CACd,CAAC;AAEF,SAAgB,kCAAkC,CAAC,cAAc;IAC/D,OAAO,cAAc,CAAC,OAAO,CAAC,gBAAgB,EAAE,UAAU,GAAG,EAAE,IAAI;QACjE,wCAAwC;QACxC,qEAAqE;QACrE,iDAAiD;QACjD,OAAO,gCAAgC,CAAC,IAAI,CAAC,CAAC;IAChD,CAAC,CAAC,CAAC;AACL,CAAC;AAPD,gFAOC;AAED,SAAgB,6BAA6B,CAAC,IAAI;IAChD,OAAO,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,UAAU,GAAG,EAAE,IAAI;QACnD,wCAAwC;QACxC,gEAAgE;QAChE,iDAAiD;QACjD,OAAO,2BAA2B,CAAC,IAAI,CAAC,CAAC;IAC3C,CAAC,CAAC,CAAC;AACL,CAAC;AAPD,sEAOC;AAED;;;;;;;;;;;;GAYG;AACU,QAAA,gBAAgB,GAAG,IAAI,MAAM,CACxC,uEAAuE,EACvE,GAAG,CACJ,CAAC;AACW,QAAA,kBAAkB,GAAG,IAAI,MAAM,CAC1C,2DAA2D,EAC3D,GAAG,CACJ,CAAC;AACW,QAAA,YAAY,GAAG,IAAI,MAAM,CACpC,sFAAsF,EACtF,GAAG,CACJ,CAAC;AAEF;;;;;;;;;;;;;;;;;;GAkBG;AACH,SAAgB,YAAY,CAAC,GAAW;;IACtC,OAAO,GAAG,CACR,MAAA,GAAG;SACA,IAAI,EAAE;SACN,OAAO,CAAC,YAAY,EAAE,IAAI,CAAC;SAC3B,KAAK,CAAC,UAAU,CAAC,mCAAI,EAAE,CAC3B,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;AACnB,CAAC;AAPD,oCAOC;AAED;;GAEG;AACH,SAAgB,QAAQ,CAAC,GAAW;IAClC,IAAI,CAAC,wBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,EAAE;QACtC,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;KACxC;IAED,OAAO,MAAM,CAAC,IAAI,CAChB,GAAG;SACA,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC;SACzB,OAAO,CAAC,oCAAoC,EAAE,EAAE,CAAC;SACjD,OAAO,CAAC,kCAAkC,EAAE,EAAE,CAAC,EAClD,QAAQ,CACT,CAAC;AACJ,CAAC;AAZD,4BAYC;AAED;;;GAGG;AACH,SAAgB,QAAQ,CACtB,GAAoB,EACpB,QAA2D;IAE3D,MAAM,SAAS,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC;QACpC,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,IAAI,EAAE;QAC/B,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;IAEzC,IAAI,wBAAgB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE;QACpC,OAAO,YAAY,CAAC,SAAS,CAAC,CAAC;KAChC;IAED,IAAI,oBAAY,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE;QAChC,IAAI,QAAQ,IAAI,IAAI,EAAE;YACpB,MAAM,IAAI,KAAK,CAAC,0CAA0C,CAAC,CAAC;SAC7D;QACD,MAAM,GAAG,GAAG,cAAc,QAAQ,UAAU,SAAS,cAAc,QAAQ,OAAO,CAAC;QAEnF,OAAO,YAAY,CAAC,GAAG,CAAC,CAAC;KAC1B;IAED,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;AACzC,CAAC;AAtBD,4BAsBC;AAED,SAAS,yBAAyB,CAChC,IAAa,EACb,UAA6B,EAAE;IAE/B,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE;QACrC,OAAO,OAAO,CAAC;KAChB;IAED,MAAM,MAAM,GAAY,IAAI,CAAC,UAAU,CAAC;IAExC,IAAI,CAAC,MAAM,EAAE;QACX,OAAO,OAAO,CAAC;KAChB;IAED,IAAI,MAAM,CAAC,UAAU,IAAI,MAAM,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;QACrD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACjD,MAAM,IAAI,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAClC,IAAI,IAAI,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE;gBACpE,OAAO,CAAC,IAAI,CAAC;oBACX,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC;oBAC7C,YAAY,EAAE,IAAI,CAAC,SAAS,IAAI,EAAE;iBACnC,CAAC,CAAC;aACJ;SACF;KACF;IAED,OAAO,yBAAyB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;AACpD,CAAC;AAED,SAAS,YAAY,CAAC,MAAM;IAC1B,MAAM,gBAAgB,GAAG,MAAM,CAAC,UAAU,CAAC;IAC3C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAChD,MAAM,QAAQ,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;QAC9C,IAAI,QAAQ,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE;YACtC,OAAO,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;SACzC;KACF;IACD,OAAO,MAAM,CAAC,MAAM,IAAI,EAAE,CAAC;AAC7B,CAAC;AAED,SAAS,eAAe,CAAC,SAAiB;IACxC,OAAO,SAAS,CAAC,KAAK,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;AAC1D,CAAC;AAED;;;;;;;;GAQG;AACH,SAAgB,cAAc,CAC5B,GAAS,EACT,cAAsB,EACtB,iBAAmC;IAEnC,MAAM,SAAS,GAAG,KAAK,CAAC,kBAAkB,CAAC,cAAc,EAAE,GAAG,EAAE,iBAAiB,CAAC,CAAC;IAEnF,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,EAAE;QAChC,OAAO,EAAE,CAAC;KACX;IAED,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,EAAE;QAC/B,MAAM,IAAI,KAAK,CAAC,0CAA0C,CAAC,CAAC;KAC7D;IAED,yCAAyC;IACzC,MAAM,UAAU,GAAG,yBAAyB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3D,MAAM,0BAA0B,GAAsB,EAAE,CAAC;IACzD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAC1C,IAAI,YAAY,GAAG,IAAI,CAAC;QACxB,KAAK,MAAM,CAAC,IAAI,0BAA0B,EAAE;YAC1C,IAAI,0BAA0B,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,UAAU,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE;gBACjE,YAAY,GAAG,KAAK,CAAC;gBACrB,MAAM;aACP;SACF;QAED,IAAI,YAAY,EAAE;YAChB,0BAA0B,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;SAChD;KACF;IAED,kFAAkF;IAClF,MAAM,WAAW,GAAsB,EAAE,CAAC;IAC1C,MAAM,cAAc,GAAG,YAAY,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;IAClD,KAAK,MAAM,UAAU,IAAI,0BAA0B,EAAE;QACnD,IAAI,UAAU,CAAC,MAAM,KAAK,cAAc,EAAE;YACxC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SAC9B;KACF;IAED,OAAO,WAAW,CAAC;AACrB,CAAC;AA1CD,wCA0CC;AAED,SAAgB,mBAAmB,CAAC,MAAM,EAAE,cAAc;IACxD,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC7C,MAAM,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;IAE7D,IAAI,OAAO,MAAM,CAAC,MAAM,KAAK,UAAU,EAAE;QACvC,OAAO,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;KACtC;IAED,oCAAoC;IACpC,IAAI,MAAM,CAAC,MAAM,KAAK,cAAc,CAAC,MAAM,EAAE;QAC3C,OAAO,KAAK,CAAC;KACd;IAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACtC,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,cAAc,CAAC,CAAC,CAAC,EAAE;YACnC,OAAO,KAAK,CAAC;SACd;KACF;IAED,OAAO,IAAI,CAAC;AACd,CAAC;AApBD,kDAoBC","sourcesContent":["import * as xpath from \"xpath\";\nimport type { NamespacePrefix } from \"./types\";\n\nexport function isArrayHasLength(array: unknown): array is unknown[] {\n  return Array.isArray(array) && array.length > 0;\n}\n\nfunction attrEqualsExplicitly(attr: Attr, localName: string, namespace?: string) {\n  return attr.localName === localName && (attr.namespaceURI === namespace || namespace == null);\n}\n\nfunction attrEqualsImplicitly(attr: Attr, localName: string, namespace?: string, node?: Element) {\n  return (\n    attr.localName === localName &&\n    ((!attr.namespaceURI && node?.namespaceURI === namespace) || namespace == null)\n  );\n}\n\nexport function findAttr(element: Element, localName: string, namespace?: string) {\n  for (let i = 0; i < element.attributes.length; i++) {\n    const attr = element.attributes[i];\n\n    if (\n      attrEqualsExplicitly(attr, localName, namespace) ||\n      attrEqualsImplicitly(attr, localName, namespace, element)\n    ) {\n      return attr;\n    }\n  }\n  return null;\n}\n\nexport function findChildren(node: Node | Document, localName: string, namespace?: string) {\n  const element = (node as Document).documentElement ?? node;\n  const res: Element[] = [];\n  for (let i = 0; i < element.childNodes.length; i++) {\n    const child = element.childNodes[i];\n    if (\n      xpath.isElement(child) &&\n      child.localName === localName &&\n      (child.namespaceURI === namespace || namespace == null)\n    ) {\n      res.push(child);\n    }\n  }\n  return res;\n}\n\n/** @deprecated */\nexport function findChilds(node: Node | Document, localName: string, namespace?: string) {\n  return findChildren(node, localName, namespace);\n}\n\nconst xml_special_to_encoded_attribute = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  '\"': \"&quot;\",\n  \"\\r\": \"&#xD;\",\n  \"\\n\": \"&#xA;\",\n  \"\\t\": \"&#x9;\",\n};\n\nconst xml_special_to_encoded_text = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  \"\\r\": \"&#xD;\",\n};\n\nexport function encodeSpecialCharactersInAttribute(attributeValue) {\n  return attributeValue.replace(/([&<\"\\r\\n\\t])/g, function (str, item) {\n    // Special character normalization. See:\n    // - https://www.w3.org/TR/xml-c14n#ProcessingModel (Attribute Nodes)\n    // - https://www.w3.org/TR/xml-c14n#Example-Chars\n    return xml_special_to_encoded_attribute[item];\n  });\n}\n\nexport function encodeSpecialCharactersInText(text) {\n  return text.replace(/([&<>\\r])/g, function (str, item) {\n    // Special character normalization. See:\n    // - https://www.w3.org/TR/xml-c14n#ProcessingModel (Text Nodes)\n    // - https://www.w3.org/TR/xml-c14n#Example-Chars\n    return xml_special_to_encoded_text[item];\n  });\n}\n\n/**\n * PEM format has wide range of usages, but this library\n * is enforcing RFC7468 which focuses on PKIX, PKCS and CMS.\n *\n * https://www.rfc-editor.org/rfc/rfc7468\n *\n * PEM_FORMAT_REGEX is validating given PEM file against RFC7468 'stricttextualmsg' definition.\n *\n * With few exceptions;\n *  - 'posteb' MAY have 'eol', but it is not mandatory.\n *  - 'preeb' and 'posteb' lines are limited to 64 characters, but\n *     should not cause any issues in context of PKIX, PKCS and CMS.\n */\nexport const PEM_FORMAT_REGEX = new RegExp(\n  \"^-----BEGIN [A-Z\\x20]{1,48}-----([^-]*)-----END [A-Z\\x20]{1,48}-----$\",\n  \"s\",\n);\nexport const EXTRACT_X509_CERTS = new RegExp(\n  \"-----BEGIN CERTIFICATE-----[^-]*-----END CERTIFICATE-----\",\n  \"g\",\n);\nexport const BASE64_REGEX = new RegExp(\n  \"^(?:[A-Za-z0-9\\\\+\\\\/]{4}\\\\n{0,1})*(?:[A-Za-z0-9\\\\+\\\\/]{2}==|[A-Za-z0-9\\\\+\\\\/]{3}=)?$\",\n  \"s\",\n);\n\n/**\n * -----BEGIN [LABEL]-----\n * base64([DATA])\n * -----END [LABEL]-----\n *\n * Above is shown what PEM file looks like. As can be seen, base64 data\n * can be in single line or multiple lines.\n *\n * This function normalizes PEM presentation to;\n *  - contain PEM header and footer as they are given\n *  - normalize line endings to '\\n'\n *  - normalize line length to maximum of 64 characters\n *  - ensure that 'preeb' has line ending '\\n'\n *\n * With a couple of notes:\n *  - 'eol' is normalized to '\\n'\n *\n * @param pem The PEM string to normalize to RFC7468 'stricttextualmsg' definition\n */\nexport function normalizePem(pem: string): string {\n  return `${(\n    pem\n      .trim()\n      .replace(/(\\r\\n|\\r)/g, \"\\n\")\n      .match(/.{1,64}/g) ?? []\n  ).join(\"\\n\")}\\n`;\n}\n\n/**\n * @param pem The PEM-encoded base64 certificate to strip headers from\n */\nexport function pemToDer(pem: string): Buffer {\n  if (!PEM_FORMAT_REGEX.test(pem.trim())) {\n    throw new Error(\"Invalid PEM format.\");\n  }\n\n  return Buffer.from(\n    pem\n      .replace(/(\\r\\n|\\r)/g, \"\")\n      .replace(/-----BEGIN [A-Z\\x20]{1,48}-----\\n?/, \"\")\n      .replace(/-----END [A-Z\\x20]{1,48}-----\\n?/, \"\"),\n    \"base64\",\n  );\n}\n\n/**\n * @param der The DER-encoded base64 certificate to add PEM headers too\n * @param pemLabel The label of the header and footer to add\n */\nexport function derToPem(\n  der: string | Buffer,\n  pemLabel?: \"CERTIFICATE\" | \"PRIVATE KEY\" | \"RSA PUBLIC KEY\",\n): string {\n  const base64Der = Buffer.isBuffer(der)\n    ? der.toString(\"base64\").trim()\n    : der.replace(/(\\r\\n|\\r)/g, \"\").trim();\n\n  if (PEM_FORMAT_REGEX.test(base64Der)) {\n    return normalizePem(base64Der);\n  }\n\n  if (BASE64_REGEX.test(base64Der)) {\n    if (pemLabel == null) {\n      throw new Error(\"PEM label is required when DER is given.\");\n    }\n    const pem = `-----BEGIN ${pemLabel}-----\\n${base64Der}\\n-----END ${pemLabel}-----`;\n\n    return normalizePem(pem);\n  }\n\n  throw new Error(\"Unknown DER format.\");\n}\n\nfunction collectAncestorNamespaces(\n  node: Element,\n  nsArray: NamespacePrefix[] = [],\n): NamespacePrefix[] {\n  if (!xpath.isElement(node.parentNode)) {\n    return nsArray;\n  }\n\n  const parent: Element = node.parentNode;\n\n  if (!parent) {\n    return nsArray;\n  }\n\n  if (parent.attributes && parent.attributes.length > 0) {\n    for (let i = 0; i < parent.attributes.length; i++) {\n      const attr = parent.attributes[i];\n      if (attr && attr.nodeName && attr.nodeName.search(/^xmlns:?/) !== -1) {\n        nsArray.push({\n          prefix: attr.nodeName.replace(/^xmlns:?/, \"\"),\n          namespaceURI: attr.nodeValue || \"\",\n        });\n      }\n    }\n  }\n\n  return collectAncestorNamespaces(parent, nsArray);\n}\n\nfunction findNSPrefix(subset) {\n  const subsetAttributes = subset.attributes;\n  for (let k = 0; k < subsetAttributes.length; k++) {\n    const nodeName = subsetAttributes[k].nodeName;\n    if (nodeName.search(/^xmlns:?/) !== -1) {\n      return nodeName.replace(/^xmlns:?/, \"\");\n    }\n  }\n  return subset.prefix || \"\";\n}\n\nfunction isElementSubset(docSubset: Node[]): docSubset is Element[] {\n  return docSubset.every((node) => xpath.isElement(node));\n}\n\n/**\n * Extract ancestor namespaces in order to import it to root of document subset\n * which is being canonicalized for non-exclusive c14n.\n *\n * @param {object} doc - Usually a product from `new xmldom.DOMParser().parseFromString()`\n * @param {string} docSubsetXpath - xpath query to get document subset being canonicalized\n * @param {object} namespaceResolver - xpath namespace resolver\n * @returns {Array} i.e. [{prefix: \"saml\", namespaceURI: \"urn:oasis:names:tc:SAML:2.0:assertion\"}]\n */\nexport function findAncestorNs(\n  doc: Node,\n  docSubsetXpath: string,\n  namespaceResolver?: XPathNSResolver,\n) {\n  const docSubset = xpath.selectWithResolver(docSubsetXpath, doc, namespaceResolver);\n\n  if (!isArrayHasLength(docSubset)) {\n    return [];\n  }\n\n  if (!isElementSubset(docSubset)) {\n    throw new Error(\"Document subset must be list of elements\");\n  }\n\n  // Remove duplicate on ancestor namespace\n  const ancestorNs = collectAncestorNamespaces(docSubset[0]);\n  const ancestorNsWithoutDuplicate: NamespacePrefix[] = [];\n  for (let i = 0; i < ancestorNs.length; i++) {\n    let notOnTheList = true;\n    for (const v in ancestorNsWithoutDuplicate) {\n      if (ancestorNsWithoutDuplicate[v].prefix === ancestorNs[i].prefix) {\n        notOnTheList = false;\n        break;\n      }\n    }\n\n    if (notOnTheList) {\n      ancestorNsWithoutDuplicate.push(ancestorNs[i]);\n    }\n  }\n\n  // Remove namespaces which are already declared in the subset with the same prefix\n  const returningNs: NamespacePrefix[] = [];\n  const subsetNsPrefix = findNSPrefix(docSubset[0]);\n  for (const ancestorNs of ancestorNsWithoutDuplicate) {\n    if (ancestorNs.prefix !== subsetNsPrefix) {\n      returningNs.push(ancestorNs);\n    }\n  }\n\n  return returningNs;\n}\n\nexport function validateDigestValue(digest, expectedDigest) {\n  const buffer = Buffer.from(digest, \"base64\");\n  const expectedBuffer = Buffer.from(expectedDigest, \"base64\");\n\n  if (typeof buffer.equals === \"function\") {\n    return buffer.equals(expectedBuffer);\n  }\n\n  // Compatibility with Node < 0.11.13\n  if (buffer.length !== expectedBuffer.length) {\n    return false;\n  }\n\n  for (let i = 0; i < buffer.length; i++) {\n    if (buffer[i] !== expectedBuffer[i]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n"]}